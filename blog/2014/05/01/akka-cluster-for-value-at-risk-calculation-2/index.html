
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Akka Cluster for Value at Risk Calculation (Part 2/2) - Eugene Zhulenev</title>
  <meta name="author" content="Eugene Zhulenev">

  
  <meta name="description" content="Synopsis The code &amp; sample app can be found on Github Risk Management in finance is one of the most common case studies
for Grid Computing, and &hellip;">
  <meta name="keywords" content="scala, akka, cluster, value-at-risk, grid, grid-computing, scalaz-stream">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://eugenezhulenev.com/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Eugene Zhulenev" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href='https://fonts.googleapis.com/css?family=Noto+Serif:400,700' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-49585535-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>

  <script>
    $(document).ready(function(){
      $('a#github').attr('target','_blank');
      $('a#github').on('click', function() {
         _gaq.push(['_trackEvent', 'ContactMe', 'Click', 'Github']);
      });

      $('a#linkedin').attr('target','_blank');
      $('a#linkedin').on('click', function() {
         _gaq.push(['_trackEvent', 'ContactMe', 'Click', 'LinkedIn']);
       });

      $('a#twitter').attr('target','_blank');
      $('a#twitter').on('click', function() {
         _gaq.push(['_trackEvent', 'ContactMe', 'Click', 'Twitter']);
      });
     });
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Eugene Zhulenev</a></h1>
  
    <h2>Engineering Machine Learning and Audience Modeling at <a href="http://collective.com">Collective</a></h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  
  
</ul>

<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/atom.xml">RSS</a></li>
  <li><a id="github" href="http://github.com/ezhulenev">Github</a></li>
  <li><a id="twitter" href="http://twitter.com/ezhulenev">Twitter</a></li>
  <li><a id="linkedin" href="http://linkedin.com/in/eugenezhulenev">Linkedin</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Akka Cluster for Value at Risk Calculation (Part 2/2)</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-01T22:03:45-04:00" pubdate data-updated="true">May 1<span>st</span>, 2014</time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://eugenezhulenev.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><h3 id="synopsis">Synopsis</h3>

<blockquote>
  <p>The code &amp; sample app can be found on <a href="https://github.com/ezhulenev/akka-var-calculation">Github</a></p>
</blockquote>

<p>Risk Management in finance is one of the most common <a href="http://www.gridgain.com/usecases/risk-management/">case studies</a>
for Grid Computing, and Value-at-Risk is most widely used risk measure.
In this article I’m going to show how to <code>scale-out</code> Value-at-Risk calculation to multiple nodes with latest <a href="http://akka.io">Akka</a> middleware.
In Part 1 I’m describing the problem and <code>single-node</code> solution, and in Part 2 I’m scaling it to multiple nodes.</p>

<h2 id="part-22-scale-out-var-calculation-to-multiple-nodes">[Part 2/2] Scale-out VaR calculation to multiple nodes</h2>

<p>Go to <a href="/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-1">Part 1</a> where Value at Risk calculator defined.</p>

<!-- more -->

<h3 id="akka-cluster">Akka Cluster</h3>

<p>Akka is amazing library for Actors abstraction for Scala and Java.</p>

<blockquote>
  <p>Actors are location transparent and distributable by design. This means that you can write your application without hardcoding how it will be deployed and distributed, and then later just configure your actor system against a certain topology <a href="http://doc.akka.io/docs/akka/snapshot/general/remoting.html">…</a></p>
</blockquote>

<p>Akka Cluster provides a fault-tolerant decentralized peer-to-peer based cluster membership service with no single point of failure or single point of bottleneck. It does this using gossip protocols and an automatic failure detector.</p>

<p>It means that it’s very easy to distribute portfolio simulations to multiple nodes.</p>

<h3 id="messages">Messages</h3>

<p>Messages that are passed around between backend &amp; calculator nodes:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="scala"><span class="line"><span class="k">object</span> <span class="nc">messages</span> <span class="o">{</span>
</span><span class="line">  <span class="k">case</span> <span class="k">object</span> <span class="nc">WakeUp</span>
</span><span class="line">
</span><span class="line">  <span class="k">case</span> <span class="k">object</span> <span class="nc">RegisterBackend</span>
</span><span class="line">
</span><span class="line">  <span class="k">case</span> <span class="k">class</span> <span class="nc">RunSimulation</span><span class="o">(</span><span class="n">positions</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Position</span><span class="o">],</span>
</span><span class="line">                           <span class="n">simulations</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
</span><span class="line">                           <span class="n">generator</span><span class="k">:</span> <span class="kt">MarketFactorsGenerator</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">case</span> <span class="k">class</span> <span class="nc">SimulationResponse</span><span class="o">(</span><span class="n">v</span><span class="k">:</span> <span class="kt">Vector</span><span class="o">[</span><span class="kt">Double</span><span class="o">])</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="simulation-backend-node">Simulation Backend Node</h3>

<p>First type of node in a cluster is SimulationNode that is going to run all ‘heavy’ portfolio price simulations.</p>

<p>After joining the cluster it subscribes for all <code>MemberUp</code> messages, and when new node with role <code>calculator</code> joins the cluster, it register itself as available backend.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
</pre></td><td class="code"><pre><code class="scala"><span class="line"><span class="k">class</span> <span class="nc">PortfolioValueSimulationBackend</span> <span class="k">extends</span> <span class="nc">Actor</span> <span class="k">with</span> <span class="nc">ActorLogging</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span> <span class="k">val</span> <span class="n">cluster</span> <span class="k">=</span> <span class="nc">Cluster</span><span class="o">(</span><span class="n">context</span><span class="o">.</span><span class="n">system</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">override</span> <span class="k">def</span> <span class="n">preStart</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">subscribe</span><span class="o">(</span><span class="n">self</span><span class="o">,</span> <span class="n">classOf</span><span class="o">[</span><span class="kt">MemberUp</span><span class="o">])</span>
</span><span class="line">
</span><span class="line">  <span class="k">override</span> <span class="k">def</span> <span class="n">postStop</span><span class="o">()</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">unsubscribe</span><span class="o">(</span><span class="n">self</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="n">receive</span> <span class="k">=</span> <span class="o">{</span>
</span><span class="line">    <span class="k">case</span> <span class="nc">RunSimulation</span><span class="o">(</span><span class="n">portfolio</span><span class="o">,</span> <span class="n">simulations</span><span class="o">,</span> <span class="n">generator</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class="line">      <span class="n">runSimulation</span><span class="o">(</span>
</span><span class="line">        <span class="nc">Portfolio</span><span class="o">(</span><span class="n">nel</span><span class="o">(</span><span class="n">portfolio</span><span class="o">.</span><span class="n">head</span><span class="o">,</span> <span class="n">portfolio</span><span class="o">.</span><span class="n">tail</span><span class="o">)),</span>
</span><span class="line">        <span class="n">simulations</span><span class="o">,</span> <span class="n">generator</span>
</span><span class="line">      <span class="o">)</span> <span class="n">pipeTo</span> <span class="n">sender</span><span class="o">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">case</span> <span class="n">state</span><span class="k">:</span> <span class="kt">CurrentClusterState</span> <span class="o">=&gt;</span>
</span><span class="line">      <span class="n">state</span><span class="o">.</span><span class="n">members</span><span class="o">.</span><span class="n">filter</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="nc">MemberStatus</span><span class="o">.</span><span class="nc">Up</span><span class="o">)</span> <span class="n">foreach</span> <span class="n">register</span>
</span><span class="line">
</span><span class="line">    <span class="k">case</span> <span class="nc">MemberUp</span><span class="o">(</span><span class="n">member</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class="line">      <span class="n">register</span><span class="o">(</span><span class="n">member</span><span class="o">)</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span> <span class="k">def</span> <span class="n">register</span><span class="o">(</span><span class="n">member</span><span class="k">:</span> <span class="kt">Member</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span><span class="line">    <span class="k">if</span> <span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="n">hasRole</span><span class="o">(</span><span class="s">&quot;calculator&quot;</span><span class="o">))</span> <span class="o">{</span>
</span><span class="line">      <span class="k">val</span> <span class="n">memberRoot</span> <span class="k">=</span> <span class="nc">RootActorPath</span><span class="o">(</span><span class="n">member</span><span class="o">.</span><span class="n">address</span><span class="o">)</span>
</span><span class="line">      <span class="k">val</span> <span class="n">backendManager</span> <span class="k">=</span>
</span><span class="line">        <span class="n">context</span><span class="o">.</span><span class="n">actorSelection</span><span class="o">(</span><span class="n">memberRoot</span> <span class="o">/</span> <span class="s">&quot;user&quot;</span> <span class="o">/</span> <span class="s">&quot;backendManager&quot;</span><span class="o">)</span>
</span><span class="line">      <span class="n">backendManager</span> <span class="o">!</span> <span class="nc">RegisterBackend</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span> <span class="k">def</span> <span class="n">runSimulation</span><span class="o">(</span><span class="n">portfolio</span><span class="k">:</span> <span class="kt">Portfolio</span><span class="o">,</span>
</span><span class="line">        <span class="n">simulations</span><span class="k">:</span> <span class="kt">Int</span><span class="o">,</span>
</span><span class="line">        <span class="n">generator</span><span class="k">:</span> <span class="kt">MarketFactorsGenerator</span><span class="o">)</span><span class="k">:</span> <span class="kt">Future</span><span class="o">[</span><span class="kt">SimulationResponse</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="k">val</span> <span class="n">process</span> <span class="k">=</span> <span class="n">generator</span><span class="o">.</span><span class="n">factors</span><span class="o">.</span><span class="n">take</span><span class="o">(</span><span class="n">simulations</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
</span><span class="line">      <span class="k">implicit</span> <span class="n">factors</span> <span class="k">=&gt;</span>
</span><span class="line">        <span class="nc">PortfolioPricer</span><span class="o">.</span><span class="n">price</span><span class="o">(</span><span class="n">portfolio</span><span class="o">).</span>
</span><span class="line">            <span class="n">fold</span><span class="o">(</span><span class="n">err</span> <span class="k">=&gt;</span> <span class="n">sys</span><span class="o">.</span><span class="n">error</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Failure: $err&quot;</span><span class="o">),</span> <span class="n">identity</span><span class="o">)</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="k">val</span> <span class="n">task</span> <span class="k">=</span> <span class="nc">Task</span><span class="o">.</span><span class="n">fork</span> <span class="o">{</span>
</span><span class="line">      <span class="n">process</span><span class="o">.</span><span class="n">runLog</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">portfolioValues</span> <span class="k">=&gt;</span> <span class="n">portfolioValues</span><span class="o">.</span><span class="n">toVector</span><span class="o">)</span>
</span><span class="line">    <span class="o">}(</span><span class="n">executor</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">val</span> <span class="n">p</span> <span class="k">=</span> <span class="nc">Promise</span><span class="o">[</span><span class="kt">SimulationResponse</span><span class="o">]()</span>
</span><span class="line">
</span><span class="line">    <span class="n">task</span><span class="o">.</span><span class="n">runAsync</span> <span class="o">{</span>
</span><span class="line">      <span class="k">case</span> <span class="o">-\/(</span><span class="n">err</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">failure</span><span class="o">(</span><span class="n">err</span><span class="o">)</span>
</span><span class="line">      <span class="k">case</span> <span class="o">\/-(</span><span class="n">result</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">p</span><span class="o">.</span><span class="n">success</span><span class="o">(</span><span class="nc">SimulationResponse</span><span class="o">(</span><span class="n">result</span><span class="o">))</span>
</span><span class="line">    <span class="o">}</span>
</span><span class="line">
</span><span class="line">    <span class="n">p</span><span class="o">.</span><span class="n">future</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="calculator-node">Calculator Node</h3>

<p>Calculator node joins the cluster, and receive <code>RegisterBackend</code> messages from simulation nodes. It keeps track of all available simulation backend nodes, and when gets a request to calculate market risk,
it splits this request into multiple simulation tasks and send them to all available simulation backends.</p>

<h5 id="backend-nodes-manager">Backend Nodes Manager</h5>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
</pre></td><td class="code"><pre><code class="scala"><span class="line"><span class="k">class</span> <span class="nc">BackendNodesManager</span> <span class="k">extends</span> <span class="nc">Actor</span> <span class="k">with</span> <span class="nc">ActorLogging</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">val</span> <span class="n">backendNodes</span> <span class="k">=</span> <span class="nc">ListBuffer</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">ActorRef</span><span class="o">]</span>
</span><span class="line">  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">var</span> <span class="n">jobCounter</span> <span class="k">=</span> <span class="mi">0</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">implicit</span> <span class="k">val</span> <span class="n">timeout</span> <span class="k">=</span> <span class="nc">Timeout</span><span class="o">(</span><span class="mf">10.</span><span class="n">seconds</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">override</span> <span class="k">def</span> <span class="n">receive</span><span class="k">:</span> <span class="kt">Receive</span> <span class="o">=</span> <span class="o">{</span>
</span><span class="line">    <span class="k">case</span> <span class="nc">WakeUp</span> <span class="k">=&gt;</span> <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="s">&quot;Wake up backend nodes manager&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">case</span> <span class="n">run</span><span class="k">:</span> <span class="kt">RunSimulation</span> <span class="o">=&gt;</span>
</span><span class="line">      <span class="n">jobCounter</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span class="line">      <span class="k">val</span> <span class="n">backendN</span> <span class="k">=</span> <span class="n">jobCounter</span> <span class="o">%</span> <span class="n">backendNodes</span><span class="o">.</span><span class="n">size</span>
</span><span class="line">      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Pass simulation request to backend: $backendN&quot;</span><span class="o">)</span>
</span><span class="line">      <span class="n">backendNodes</span><span class="o">(</span><span class="n">backendN</span><span class="o">)</span> <span class="o">?</span> <span class="n">run</span> <span class="n">pipeTo</span> <span class="n">sender</span><span class="o">()</span>
</span><span class="line">
</span><span class="line">    <span class="k">case</span> <span class="nc">RegisterBackend</span> <span class="k">if</span> <span class="o">!</span><span class="n">backendNodes</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">sender</span><span class="o">())</span> <span class="k">=&gt;</span>
</span><span class="line">      <span class="n">context</span> <span class="n">watch</span> <span class="n">sender</span><span class="o">()</span>
</span><span class="line">      <span class="n">backendNodes</span> <span class="o">+=</span> <span class="n">sender</span><span class="o">()</span>
</span><span class="line">      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Added new backend. &quot;</span><span class="o">+</span>
</span><span class="line">                <span class="n">s</span><span class="s">&quot;Total: ${backendNodes.size}. Node: [${sender()}}]&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">    <span class="k">case</span> <span class="nc">Terminated</span><span class="o">(</span><span class="n">backEnd</span><span class="o">)</span> <span class="k">if</span> <span class="n">backendNodes</span><span class="o">.</span><span class="n">contains</span><span class="o">(</span><span class="n">backEnd</span><span class="o">)</span> <span class="k">=&gt;</span>
</span><span class="line">      <span class="n">backendNodes</span> <span class="o">-=</span> <span class="n">sender</span><span class="o">()</span>
</span><span class="line">      <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Removed terminated backend. &quot;</span><span class="o">+</span>
</span><span class="line">                <span class="n">s</span><span class="s">&quot;Total: ${backendNodes.size}. &quot;</span><span class="o">+</span>
</span><span class="line">                <span class="n">s</span><span class="s">&quot;Terminated node: [${sender()}}]&quot;</span><span class="o">)</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h5 id="cluster-portfolio-value-simulation">Cluster Portfolio Value Simulation</h5>

<p>Simulation channel constructed by <code>asking</code> backend simulation actors to run simulation and converting <code>scala.concurrent.Future</code> to <code>scalaz.concurrent.Task</code>. Concurrency management and split factor is defined
in abstract monte carlo risk calculator described in <a href="/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-1">Part 1</a></p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
</pre></td><td class="code"><pre><code class="scala"><span class="line"><span class="k">trait</span> <span class="nc">ClusterPortfolioValueSimulation</span> <span class="k">extends</span> <span class="nc">PortfolioValueSimulation</span> <span class="o">{</span>
</span><span class="line">  <span class="n">self</span><span class="k">:</span> <span class="kt">MarketFactorsModule</span> <span class="kt">with</span> <span class="kt">MonteCarloMarketRiskCalculator</span> <span class="o">=&gt;</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="n">systemName</span><span class="k">:</span> <span class="kt">String</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="n">systemConfig</span><span class="k">:</span> <span class="kt">Config</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">system</span> <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="n">systemName</span><span class="o">,</span> <span class="n">systemConfig</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">private</span><span class="o">[</span><span class="kt">this</span><span class="o">]</span> <span class="k">lazy</span> <span class="k">val</span> <span class="n">backendManager</span> <span class="k">=</span>
</span><span class="line">    <span class="n">system</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">BackendNodesManager</span><span class="o">],</span> <span class="s">&quot;backendManager&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="n">simulation</span><span class="o">(</span><span class="n">portfolio</span><span class="k">:</span> <span class="kt">Portfolio</span><span class="o">,</span> <span class="n">simulations</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=</span>
</span><span class="line">    <span class="n">channel</span><span class="o">[</span><span class="kt">MarketFactorsGenerator</span>, <span class="kt">Simulations</span><span class="o">]</span> <span class="o">{</span> <span class="n">generator</span> <span class="k">=&gt;</span>
</span><span class="line">      <span class="nc">Task</span><span class="o">.</span><span class="n">async</span><span class="o">[</span><span class="kt">Simulations</span><span class="o">](</span><span class="n">cb</span> <span class="k">=&gt;</span> <span class="o">{</span>
</span><span class="line">        <span class="o">(</span><span class="n">backendManager</span> <span class="o">?</span> <span class="nc">RunSimulation</span><span class="o">(...)).</span><span class="n">onComplete</span> <span class="o">{</span>
</span><span class="line">          <span class="k">case</span> <span class="nc">Failure</span><span class="o">(</span><span class="n">err</span><span class="o">)</span>                   <span class="k">=&gt;</span> <span class="n">cb</span><span class="o">(-\/(</span><span class="n">err</span><span class="o">))</span>
</span><span class="line">          <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="nc">SimulationResponse</span><span class="o">(</span><span class="n">s</span><span class="o">))</span> <span class="k">=&gt;</span> <span class="n">cb</span><span class="o">(\/-(</span><span class="nc">Simulations</span><span class="o">(</span><span class="n">s</span><span class="o">)))</span>
</span><span class="line">          <span class="k">case</span> <span class="nc">Success</span><span class="o">(</span><span class="n">u</span><span class="o">)</span>                     <span class="k">=&gt;</span>
</span><span class="line">            <span class="n">cb</span><span class="o">(-\/(</span><span class="k">new</span> <span class="nc">IllegalStateException</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Unknown response: $u&quot;</span><span class="o">)))</span>
</span><span class="line">        <span class="o">}</span>
</span><span class="line">      <span class="o">})</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="run-calculation-in-cluster">Run Calculation in Cluster</h3>

<p>In this example I’m going to run all nodes in a single JVM for simplicity. Distributed deployment is only Akka configuration issue, and it doesn’t affect the code at all.</p>

<p>I’m starting three <code>simulation backend</code> nodes in a cluster, and later join them with <code>calculator</code> node, and submit risk calculation task.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
<span class="line-number">32</span>
<span class="line-number">33</span>
<span class="line-number">34</span>
<span class="line-number">35</span>
<span class="line-number">36</span>
<span class="line-number">37</span>
<span class="line-number">38</span>
<span class="line-number">39</span>
<span class="line-number">40</span>
<span class="line-number">41</span>
<span class="line-number">42</span>
<span class="line-number">43</span>
<span class="line-number">44</span>
<span class="line-number">45</span>
<span class="line-number">46</span>
<span class="line-number">47</span>
<span class="line-number">48</span>
<span class="line-number">49</span>
<span class="line-number">50</span>
<span class="line-number">51</span>
<span class="line-number">52</span>
<span class="line-number">53</span>
<span class="line-number">54</span>
<span class="line-number">55</span>
<span class="line-number">56</span>
<span class="line-number">57</span>
<span class="line-number">58</span>
<span class="line-number">59</span>
<span class="line-number">60</span>
<span class="line-number">61</span>
<span class="line-number">62</span>
<span class="line-number">63</span>
<span class="line-number">64</span>
<span class="line-number">65</span>
<span class="line-number">66</span>
<span class="line-number">67</span>
<span class="line-number">68</span>
<span class="line-number">69</span>
<span class="line-number">70</span>
<span class="line-number">71</span>
<span class="line-number">72</span>
</pre></td><td class="code"><pre><code class="scala"><span class="line"><span class="k">object</span> <span class="nc">ClusterMarketRiskCalculation</span> <span class="k">extends</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class="line">  <span class="k">val</span> <span class="nc">SystemName</span> <span class="k">=</span> <span class="s">&quot;ClusterMarketRiskCalculation&quot;</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="n">simulationConfig</span> <span class="k">=</span> <span class="nc">ConfigFactory</span><span class="o">.</span><span class="n">parseResources</span><span class="o">(</span><span class="s">&quot;simulation-node.conf&quot;</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="n">calculatorConfig</span> <span class="k">=</span> <span class="nc">ConfigFactory</span><span class="o">.</span><span class="n">parseResources</span><span class="o">(</span><span class="s">&quot;calculator-node.conf&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Start 3 simulation nodes</span>
</span><span class="line">  <span class="k">val</span> <span class="n">system1</span>  <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">SystemName</span><span class="o">,</span> <span class="n">simulationConfig</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="n">joinAddress</span> <span class="k">=</span> <span class="nc">Cluster</span><span class="o">(</span><span class="n">system1</span><span class="o">).</span><span class="n">selfAddress</span>
</span><span class="line">  <span class="nc">Cluster</span><span class="o">(</span><span class="n">system1</span><span class="o">).</span><span class="n">join</span><span class="o">(</span><span class="n">joinAddress</span><span class="o">)</span>
</span><span class="line">  <span class="n">system1</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">PortfolioValueSimulationBackend</span><span class="o">],</span> <span class="s">&quot;simulationBackend&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="n">system2</span>  <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">SystemName</span><span class="o">,</span> <span class="n">simulationConfig</span><span class="o">)</span>
</span><span class="line">  <span class="nc">Cluster</span><span class="o">(</span><span class="n">system2</span><span class="o">).</span><span class="n">join</span><span class="o">(</span><span class="n">joinAddress</span><span class="o">)</span>
</span><span class="line">  <span class="n">system2</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">PortfolioValueSimulationBackend</span><span class="o">],</span> <span class="s">&quot;simulationBackend&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="n">system3</span>  <span class="k">=</span> <span class="nc">ActorSystem</span><span class="o">(</span><span class="nc">SystemName</span><span class="o">,</span> <span class="n">simulationConfig</span><span class="o">)</span>
</span><span class="line">  <span class="nc">Cluster</span><span class="o">(</span><span class="n">system3</span><span class="o">).</span><span class="n">join</span><span class="o">(</span><span class="n">joinAddress</span><span class="o">)</span>
</span><span class="line">  <span class="n">system3</span><span class="o">.</span><span class="n">actorOf</span><span class="o">(</span><span class="nc">Props</span><span class="o">[</span><span class="kt">PortfolioValueSimulationBackend</span><span class="o">],</span> <span class="s">&quot;simulationBackend&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Start Cluster Risk Calculator node</span>
</span><span class="line">  <span class="k">object</span> <span class="nc">RiskCalculator</span>
</span><span class="line">    <span class="k">extends</span> <span class="nc">MonteCarloMarketRiskCalculator</span><span class="o">(</span><span class="mi">10000</span><span class="o">,</span> <span class="mi">10</span><span class="o">)</span>
</span><span class="line">    <span class="k">with</span> <span class="nc">ClusterPortfolioValueSimulation</span>
</span><span class="line">    <span class="k">with</span> <span class="nc">HistoricalMarketFactors</span> <span class="k">with</span> <span class="nc">HistoricalMarketData</span> <span class="o">{</span>
</span><span class="line">
</span><span class="line">    <span class="k">val</span> <span class="n">systemName</span> <span class="k">=</span> <span class="nc">SystemName</span>
</span><span class="line">    <span class="k">val</span> <span class="n">systemConfig</span> <span class="k">=</span> <span class="n">calculatorConfig</span>
</span><span class="line">  <span class="o">}</span>
</span><span class="line">
</span><span class="line">  <span class="nc">RiskCalculator</span><span class="o">.</span><span class="n">join</span><span class="o">(</span><span class="n">joinAddress</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Let&#39;s cluster state some time to converge</span>
</span><span class="line">  <span class="nc">Thread</span><span class="o">.</span><span class="n">sleep</span><span class="o">(</span><span class="mi">2000</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Run VaR calculation</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="nc">AMZN</span> <span class="k">=</span> <span class="nc">Equity</span><span class="o">(</span><span class="s">&quot;AMZN&quot;</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="nc">AAPL</span> <span class="k">=</span> <span class="nc">Equity</span><span class="o">(</span><span class="s">&quot;AAPL&quot;</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="nc">IBM</span> <span class="k">=</span> <span class="nc">Equity</span><span class="o">(</span><span class="s">&quot;IBM&quot;</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="nc">GS</span> <span class="k">=</span> <span class="nc">Equity</span><span class="o">(</span><span class="s">&quot;GS&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Portfolio evaluation date</span>
</span><span class="line">  <span class="k">val</span> <span class="n">date</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LocalDate</span><span class="o">(</span><span class="mi">2014</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">3</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Options maturity date</span>
</span><span class="line">  <span class="k">val</span> <span class="n">maturityDate</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">LocalDate</span><span class="o">(</span><span class="mi">2014</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">31</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="n">portfolio</span> <span class="k">=</span> <span class="nc">Portfolio</span><span class="o">(</span><span class="n">nels</span><span class="o">(</span>
</span><span class="line">    <span class="nc">Position</span><span class="o">(</span><span class="nc">AMZN</span><span class="o">,</span> <span class="mi">10</span><span class="o">),</span>
</span><span class="line">    <span class="nc">Position</span><span class="o">(</span><span class="nc">AAPL</span><span class="o">,</span> <span class="mi">20</span><span class="o">),</span>
</span><span class="line">    <span class="nc">Position</span><span class="o">(</span><span class="nc">IBM</span><span class="o">,</span> <span class="mi">30</span><span class="o">),</span>
</span><span class="line">    <span class="nc">Position</span><span class="o">(</span><span class="nc">CallOption</span><span class="o">(</span><span class="nc">GS</span><span class="o">,</span> <span class="mi">180</span><span class="o">,</span> <span class="n">maturityDate</span><span class="o">),</span> <span class="mi">10</span><span class="o">)</span>
</span><span class="line">  <span class="o">))</span>
</span><span class="line">
</span><span class="line">  <span class="k">val</span> <span class="n">start</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class="line">  <span class="k">val</span> <span class="n">marketRisk</span> <span class="k">=</span> <span class="nc">RiskCalculator</span><span class="o">.</span><span class="n">marketRisk</span><span class="o">(</span><span class="n">portfolio</span><span class="o">,</span> <span class="n">date</span><span class="o">)</span>
</span><span class="line">  <span class="k">val</span> <span class="n">end</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span><span class="line">
</span><span class="line">  <span class="n">println</span><span class="o">(</span><span class="n">s</span><span class="s">&quot;Calculated marker risk in ${end - start} milliseconds; &quot;</span> <span class="o">+</span>
</span><span class="line">    <span class="n">s</span><span class="s">&quot;VaR(p = 0.95) = ${marketRisk.VaR(0.95)}, &quot;</span> <span class="o">+</span>
</span><span class="line">    <span class="n">s</span><span class="s">&quot;CVaR(p = 0.95) = ${marketRisk.conditionalVaR(0.95)}&quot;</span><span class="o">)</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// Shutdown actor systems</span>
</span><span class="line">  <span class="n">system1</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
</span><span class="line">  <span class="n">system2</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
</span><span class="line">  <span class="n">system3</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
</span><span class="line">  <span class="nc">RiskCalculator</span><span class="o">.</span><span class="n">shutdown</span><span class="o">()</span>
</span><span class="line">
</span><span class="line">  <span class="c1">// and application</span>
</span><span class="line">  <span class="nc">System</span><span class="o">.</span><span class="n">exit</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
</span><span class="line"><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h3 id="conclusion">Conclusion</h3>

<p>As I showed in this post moving calculations to a cluster can be easy and fun task with Akka Cluster.</p>

<p>I use scalaz-stream for abstracting over <code>effectful functions</code> with <code>scalaz.stream.Channel</code>, I guess it maybe be overengineering in this particular case,
but it allows to completely hide implementation details and take control concurrency in very abstract way.
And scalaz-stream is very nice and super powerful library, I strongly encourage you to take a look on it.</p>

<h5 id="links">Links</h5>

<ol>
  <li>Akka http://akka.io/ and http://doc.akka.io/docs/akka/2.3.2/scala/index-network.html</li>
  <li>Scalaz-stream https://github.com/scalaz/scalaz-stream</li>
  <li>Value at Risk http://en.wikipedia.org/wiki/Value_at_risk</li>
</ol>

<h4 id="check-source-code-on-githubhttpsgithubcomezhulenevakka-var-calculation">Check source code on <a href="https://github.com/ezhulenev/akka-var-calculation">GitHub</a></h4>

<h2 id="go-to-part-1blog20140501akka-cluster-for-value-at-risk-calculation-1"><a href="/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-1">«&lt; Go to Part 1</a></h2>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Eugene Zhulenev</span></span>

      








  


<time datetime="2014-05-01T22:03:45-04:00" pubdate data-updated="true">May 1<span>st</span>, 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/akka/'>akka</a>, <a class='category' href='/blog/categories/cluster/'>cluster</a>, <a class='category' href='/blog/categories/grid/'>grid</a>, <a class='category' href='/blog/categories/scala/'>scala</a>, <a class='category' href='/blog/categories/scalaz-stream/'>scalaz-stream</a>, <a class='category' href='/blog/categories/value-at-risk/'>value-at-risk</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://eugenezhulenev.com/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-2/" data-via="ezhulenev" data-counturl="http://eugenezhulenev.com/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-2/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-1/" title="Previous Post: Akka Cluster for Value at Risk calculation (Part 1/2)">&laquo; Akka Cluster for Value at Risk calculation (Part 1/2)</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/10/18/run-tests-in-standalone-spark-cluster/" title="Next Post: Running Spark tests in standalone cluster">Running Spark tests in standalone cluster &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

  <aside class="sidebar">
   
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:eugenezhulenev.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/09/16/spark-ml-for-big-and-small-data/">Optimizing Spark Machine Learning for Small Data</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/09/09/audience-modeling-with-spark-ml-pipelines/">Audience Modeling With Spark ML Pipelines</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/15/interactive-audience-analytics-with-spark-and-hyperloglog/">Interactive Audience Analytics With Spark and HyperLogLog</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/06/10/feature-engineering-at-scale/">Feature Engineering at Scale With Spark</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/11/20/twitter-analytics-with-spark/">Building Twitter Live Stream Analytics With Spark and Cassandra</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/ezhulenev">@ezhulenev</a> on GitHub
  
  <script type="text/javascript">
    $(document).ready(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'ezhulenev',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>





  
</aside>



    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Eugene Zhulenev -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'eugenezhulenev';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://eugenezhulenev.com/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-2/';
        var disqus_url = 'http://eugenezhulenev.com/blog/2014/05/01/akka-cluster-for-value-at-risk-calculation-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>



<script>
  $(document).ready(function() {  
  var stickyNavTop = $('nav').offset().top;  
    
  var stickyNav = function(){  
  var scrollTop = $(window).scrollTop();  
         
  if (scrollTop > stickyNavTop) {   
      $('nav').addClass('sticky');  
  } else {  
      $('nav').removeClass('sticky');   
  }  
  };  
    
  stickyNav();  
    
  $(window).scroll(function() {  
      stickyNav();  
  });  
  });  
</script>


</body>
</html>
